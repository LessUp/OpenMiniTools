# Windows系统健康检查脚本

## 概述

这是一个全面的Windows系统健康检查PowerShell脚本，能够自动检测系统问题并提供修复建议。脚本支持自动修复功能和详细的HTML报告生成。

## 功能特性

### 🔍 系统检查功能
- **系统资源监控**: CPU使用率、内存使用率、磁盘空间检查
- **系统服务状态**: 关键Windows服务运行状态验证
- **网络连接测试**: 网络适配器、DNS解析、连通性测试
- **系统文件完整性**: SFC和DISM系统文件检查
- **Windows更新状态**: 检查待安装更新和更新历史
- **事件日志分析**: 扫描系统、应用程序、安全日志中的错误
- **启动项检查**: 识别可能影响启动速度的程序

### 🔧 自动修复功能
- 重启停止的关键系统服务
- 清理DNS缓存解决网络问题
- 修复Windows映像损坏
- 清理临时文件和垃圾文件
- 清理回收站和运行磁盘清理

### 📊 报告功能
- 生成详细的HTML格式报告
- 按严重程度分类问题（严重、警告、信息）
- 提供具体的修复建议和操作指导
- 记录检查时间和系统基本信息
- 生成详细的日志文件

## 系统要求

- **PowerShell版本**: 7.0 或更高版本
- **权限要求**: 必须以管理员身份运行
- **操作系统**: Windows 10/11 或 Windows Server 2016+

## 使用方法

### 基本用法

```powershell
# 交互模式运行（推荐）
.\Windows-HealthCheck.ps1

# 静默模式运行
.\Windows-HealthCheck.ps1 -Silent

# 启用自动修复功能
.\Windows-HealthCheck.ps1 -AutoFix

# 静默模式 + 自动修复
.\Windows-HealthCheck.ps1 -Silent -AutoFix

# 指定报告输出路径
.\Windows-HealthCheck.ps1 -OutputPath "C:\Reports"
```

### 参数说明

| 参数 | 类型 | 说明 |
|------|------|------|
| `-Silent` | 开关 | 静默运行模式，不显示交互提示 |
| `-AutoFix` | 开关 | 自动修复发现的问题 |
| `-OutputPath` | 字符串 | 指定报告和日志输出路径（默认为脚本目录） |

### 获取帮助

```powershell
.\Windows-HealthCheck.ps1 -Help
```

## 输出文件

脚本运行后会在指定目录生成以下文件：

1. **HTML报告**: `HealthCheck_Report_YYYYMMDD_HHMMSS.html`
   - 包含完整的检查结果和修复建议
   - 按问题严重程度分类显示
   - 包含系统基本信息

2. **日志文件**: `HealthCheck_YYYYMMDD_HHMMSS.log`
   - 详细的执行日志
   - 包含所有检查步骤和结果
   - 错误信息和调试信息

## 问题严重程度分类

### 🔴 严重问题 (Critical)
- CPU使用率超过80%
- 内存使用率超过90%
- 磁盘空间不足10%
- 关键系统服务未运行
- 网络连接完全失败
- Windows映像损坏

### 🟡 警告 (Warning)
- CPU使用率60-80%
- 内存使用率80-90%
- 磁盘空间10-20%
- 大量事件日志错误
- 启动项过多
- 部分网络连接失败

### 🔵 信息 (Info)
- 系统维护操作记录
- 清理操作结果
- 正常状态确认

## 安全注意事项

⚠️ **重要提醒**:
- 脚本需要管理员权限运行
- 自动修复功能会修改系统设置，请谨慎使用
- 建议在测试环境中先验证脚本功能
- 定期备份重要数据

## 最佳实践

1. **定期运行**: 建议每周运行一次健康检查
2. **监控趋势**: 保存历史报告，观察系统健康趋势
3. **及时处理**: 优先处理严重问题，定期处理警告
4. **系统维护**: 结合其他系统维护工具使用

## 故障排除

### 常见问题

**Q: 脚本提示需要管理员权限**
A: 右键点击PowerShell，选择"以管理员身份运行"

**Q: 执行策略限制**
A: 运行 `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`

**Q: 某些检查失败**
A: 查看日志文件了解详细错误信息，可能需要安装相关模块

**Q: 自动修复没有生效**
A: 确保使用了 `-AutoFix` 参数，某些问题可能需要手动处理

## 扩展功能

脚本采用模块化设计，可以轻松添加新的检查功能：

1. 创建新的检查函数
2. 在主函数中添加函数调用
3. 更新帮助文档

## 版本信息

- **当前版本**: 1.0
- **最后更新**: 2024年
- **兼容性**: PowerShell 7.0+, Windows 10/11

## 许可证

此脚本仅供学习和内部使用，请遵守相关法律法规。

---

**注意**: 使用此脚本前请确保了解其功能和潜在影响，建议在非生产环境中测试。
